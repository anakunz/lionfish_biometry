---
title: \normalsize{Biometry of the invasive lionfish (\textit{Pterois volitans}) in Playa del Carmen, Mexico and a review of length - weight parameters across the invasion range}
header-includes:
- \usepackage{setspace}
- \doublespacing
- \usepackage{lineno}
- \linenumbers
output:
  pdf_document:
    fig_caption: yes
fontsize: 12pt
bibliography: references.bib
---

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { 
      equationNumbers: { 
            autoNumber: "all",
            formatNumber: function (n) {return '9.'+n}
      } 
  }
});
</script>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)

windowsFonts(Times=windowsFont("TT Times New Roman"))
```

```{r load packages}
suppressPackageStartupMessages({
  library(RColorBrewer)
  library(colorRamps)
  library(stargazer)
  library(sandwich)
  library(lmtest)
  library(broom)
  library(tmap)
  library(tmaptools)
  library(rgdal)
  library(sp)
  library(RefManageR)
  library(tidyverse)
})

# source('./update_ref.R')
# update_ref()
```


Juan Carlos Villaseñor-Derbez^1^\


^1^ Bren School of Environmental Sciences and Management, University of California Santa Barbara\


**Full postal address:**
4312 Bren Hall, Santa Barbara, CA, 93106\


**Running title:** Length - weight parameters for *Pterois volitans* \


*Corresponding author information:*

Juan Carlos Villaseñor-Derbez   
4312 Bren Hall  
Santa Barbara, CA   
93106   
jvillasenor@bren.ucsb.edu   
+1 (207) 205 8435

\clearpage

**Title of the contribution:** Biometry of the invasive lionfish (*Pterois volitans*) in Playa del Carmen, Mexico and a review of length - weight parameters across the invasion range\


**Abstract**

300 words\


**Key words**

lionfish, biometry, length-weight relationship, Mexico\


**Resumen**

300 palabras\


**Palabras clave**

pez león, biometría, relación lopngitud-peso, México\


\clearpage

# Introduction

Lionfish

Lionfish (*Pterois volitans - miles* complex) are an invasive species in the North-Western Atlantic and the Caribbean. They are the first marine vertebrates to establish in North Atlantic [@schofield_2009: @schofield_2010] and Caribbean coasts. Their presence in these waters has been labeled as a major marine invasion due to its threat to local biodiversity, the veolocity of its invasion, and the difficulty of management [@hixon_2016].

Liofnish have been prooven to reduce recruitment of local reef fish species [@albins_2008]. Their diet focuses on small demersal reef-associated fish and crustaceans [@morris_2009; @villaseorderbez_2014].

Lionfish were first recorded in Mexican waters in 2010 [@aguilarperera_2010].


Studies quantifying biomass from visual surveys / Ecosim simulations / stock assessments

Significant efforts have been made to understand the possible impacts of the invasion by X (cita de X), y (cita de Y) y z (cita de Z). An important pair of parameters often used in these studies are those which allow researchers to convert observed lengths into weights (*i.e.* weight-at-length parameters) to estimate biomass. Having presission of these parameters is important, because small changes in any of them can result in important over- or unnderestimation of biomass levels. This becomes particularly important when research involves, for example, identifying the total biomass available for harvest by fishers (as invasion management programs).

Objectives

The objectives of this study include providing site-specific weight-at-length parameters for the invasive lionfish in the Mexican Caribbean region. At the same time, we highlight the importance of using site-specific parameters by using those from other studies and comparing predicted weights to those found in this study. Finaly, we provide a review of and summarize other weight-at-length studies presented, making them readily accessible for future research.

# Materials and Methods

```{r load fish data, include = F}
fish <- read_csv("./lionfish_data.csv", col_types = cols()) %>% 
  group_by(Id, Site, Location, Latitude, Longitude, Depth_m) %>% 
  summarize(Length = 10*mean(TotalLength_cm),
            Weight = mean(TotalWeigth_gr),
            Stomach = mean(StomachLength_cm)) %>% 
  ungroup()
```

## Area of study

The present study took place off the coasts of Playa del Carmen, in the coasts of the Mexican Caribbean. The region represents the northernmost section of the Mesoamerican reef, which extends from coast of Cancun south to Honduras (**reference**). Coral reefs and mangroves are important habitats distributed along the cost, and represent important sources of income in terms of extractive (*e.g.* recreational fishing) and non-extractive (*e.g.* SCUBA diving) activities related to tourism (**reference**), the main source of income to the local economy.

Coral reefs in the region are characterized by X, Y, Z. Descripcion general de los arrecifes.

```{r create map, include = F}
# Load shapefiles
proj <- CRS("+proj=longlat +datum=NAD27")

stat <- readOGR(dsn = "./Spatial", layer = "states", verbose = F)

qroo <- readOGR(dsn = "./Spatial", layer = "muni_2015gw", verbose = F)

qroo <-qroo[qroo$NOM_ENT == "Quintana Roo",]

#Small shapefile for region of interest
xy1 <- data.frame(X = mean(-87.30662, -87.19194), Y = mean(20.39283, 20.51278))
coordinates(xy1) <- c("X", "Y")
proj4string(xy1) <- proj
res1 <- spTransform(xy1, proj)

#Create shapefile for sampling locations
sample_points <- fish %>%
  group_by(Location) %>%
  summarize(latitude = mean(Latitude, na.rm = T),
            longitude = mean(Longitude, na.rm = T)) %>%
  ungroup()

xy <- data.frame(X = -1*abs(sample_points$longitude), Y = sample_points$latitude)
coordinates(xy) <- c("X", "Y")
proj4string(xy) <- proj  ## for example
res <- spTransform(xy, proj)
b <- SpatialPointsDataFrame(coords = res, data = sample_points, proj4string = proj)

# Create shapefile for relevant communities
Communities <- data.frame(Longitude = c(-87.24),
                           Latitude = c(20.5),
                           Location = c("Pto. Aventuras"),
                           stringsAsFactors = F)

xy2 <- data.frame(X = -1*abs(Communities$Longitude), Y = Communities$Latitude)
coordinates(xy2) <- c("X", "Y")
proj4string(xy2) <- proj  ## for example
res2 <- spTransform(xy2, proj)
c <- SpatialPointsDataFrame(coords = res2, data = Communities, proj4string = proj)

pen_map <- tm_shape(stat, bbox = bb(xlim = c(-89.29656, -86.71074), ylim = c(17.89399, 21.60525))) +
  tm_polygons() +
  tm_shape(res1) +
  tm_symbols(shape = 5, size = 2, border.col = "black", col = "black", border.lwd = 2) +
  tm_grid() +
  tm_scale_bar()

study_area <- tm_shape(qroo, bbox = bb(xlim = c(-87.30662, -87.19194), ylim = c(20.39283, 20.51278))) +
  tm_polygons() +
  tm_shape(b) +
  tm_symbols(size = 0.125, border.col = "black", col = "black") +
  tm_shape(c) +
  tm_symbols(shape = 18, col = "black", border.col = "black", size = 0.5) +
  tm_compass() +
  tm_scale_bar()

tmap_arrange(pen_map, study_area, outer.margins = 0.005, ncol = 2)

```

## Fish sampling

The present study uses samples obtained by Villaseñor-Derbez & Herrera-Pérez [-@villaseorderbez_2014] for stomach content analysis between May and August of 2010. A total of 33 SCUBA immersions were performed in `r length(unique(fish$Location))` sampling sites along 14 Km of coast between Puerto Aventuras and Akumal (Fig. 1, Table 1). All observed organisms (n = `r dim(fish)[1]`) were collected using hand nets -to avoid weight loss due to bleeding- and numbered collection bottles. Information on Depth and other comments were recorded in an underwater slide. Depth was recorded by dive gauges held by divers as safety procedures during the collections. Samples were frozen within 30 mins of completing the dive and stored for posterior analysis in the lab. Sampling locations included wall and carpet reefs at depths between `r min(fish$Depth_m)` m and `r max(fish$Depth_m)` m. For every organism Total Length (TL; mm) and Total Weight (TW; gr) were recorded in the lab.

```{r table of locations, include = F}
total <- data.frame(Location = "Total", Latitude = "", Longitude = "", minD = min(fish$Depth_m), maxD = max(fish$Depth_m), meanD = formatC(mean(fish$Depth_m), digits = 1, format = "f"), n = 109, stringsAsFactors = F)

location_table <- fish %>% 
  group_by(Location) %>% 
  summarize(Latitude = formatC(mean(Latitude), digits = 3, format = "f"),
            Longitude = formatC(mean(Longitude), digits = 3, format = "f"),
            minD = formatC(min(Depth_m), digits = 1, format = "f"),
            maxD = formatC(max(Depth_m), digits = 1, format = "f"),
            meanD = formatC(mean(Depth_m), digits = 1, format = "f"),
            n = n()) %>% 
  rbind(total) %>% 
  knitr::kable(row.names = F, caption = "Coordinates, minimum, maximum and mean depth (m), and number of samples for each location. n = sample size.", col.names = c("Location", "Latitude", "Longitude", "Minimum Depth (m)", "Maximum Depth (m)", "Mean Depth (m)", "n"))

location_table
```

## Data analysis

The weight at length relationship between the observed variables was calculated with the allometric growth function:

\begin{equation}TW = aTL^b\end{equation}

Where $TW$ is the Total Weight (gr), $TL$ is the observed Total Length (mm), $a$ is the scaling parameter and $b$ is the exponent (**revisar**). The dependent and independent variables were transformed via base-10 logarithms so that the equation is then:

\begin{equation}log_{10}(TW) = blog_{10}TL + log{10}(a)\end{equation}

To simplify this equation, we can re-write it as:

\begin{equation}Y = mX + c\end{equation}

Where $Y = log_{10}(TW)$, $X = log_{10}(TL)$, $m = b$, and $c = log_{10}(a)$. This equation was used to estimate the coefficients ($a$ and $b$), which were estimated via an Ordinary Least Square Regression and heteroskedastic-robust; Standard Errors were calculated to account for **lo que sea que Olivier dijo que era importante**.

  - Conversions to biomass

  -Lit review

When reviewing other length-weight relationships, it was noticed that some papers indistinctly use $a$ to report either the multiplying coefficient in **eq. 1** or the y-intercept ($c$) in **eq. 2**, which might sometimes be overlooked. Furthermore, some studies report their parameters as mm-to-gr conversions, but a rapid evaluation of such parameters indicates that they were estimated as cm-to-gr conversions (Fig. A1). Here, both parameters ($a$ and $c$) are reported for the present findings and, when ever required, coefficients from other studies are converted. All coefficients are reported as mm to gr conversions.


# Results

## Length-weight relationship

```{r summary table, include = F}
summary_table <- fish %>% 
  select(Length, Weight) %>% 
  as.data.frame() %>% 
  stargazer(header = F, type = "latex", digits = 2, title = "Summary statistics of Length and Weight of sampled organisms.")
```

```{r histogram figures, include = F}
length_hist <- ggplot(data = fish, mapping = aes(x = Length)) +
  geom_density(fill = "gray", alpha = 0.5) +
  theme_bw() +
  ggExtra::removeGrid() +
  labs(x = "Total Length (mm)", y = "Density") +
  geom_text(label = "a)", x = 310, y = 0.007) +
  theme(text = element_text(family = "Times"))

weight_hist <- ggplot(data = fish, mapping = aes(x = Weight)) +
  geom_density(fill = "gray", alpha = 0.5) +
  theme_bw() +
  ggExtra::removeGrid() +
  labs(x = "Total weight (gr)", y = "Density") +
  geom_text(label = "b)", x = 400, y = 0.017) +
  theme(text = element_text(family = "Times"))

gridExtra::grid.arrange(length_hist, weight_hist)
```

```{r model fitting}
model <- lm(log10(Weight) ~ log10(Length), data = fish)
```

```{r regression table, include = F}
TidyModel <- model%>%
  lmtest::coeftest(vcov = sandwich::vcovHC(., type = "HC1")) %>%
  broom::tidy()

robust_se <- TidyModel$std.error %>%
  set_names(TidyModel$term)

wald_results <- waldtest(model, vcov = vcovHC(model, type = "HC1"))
f_string <- c("F Statistic", paste0(formatC(wald_results$F[2], digits = 2, format = "f"), "*** (df = 1; ", dim(fish)[1]-2,")"))

regression_table <- stargazer(model,
          header = F,
          se = list(robust_se),
          type = "latex",
          t.auto = T,
          p.auto = T,
          intercept.bottom = F,
          single.row = T,
          report = "vcs*",
          omit.stat = c("rsq", "f"),
          add.lines = list(f_string),
          ci = T)
```
\clearpage

## Comparison of allometric parameters

```{r, include = F}
review <- read_csv("biometric_review.csv", col_types = cols())

review_table <- review %>% 
  select(Reference, n = N, a, c, b, r2, Gender, minD, maxD, Spear) %>% 
  knitr::kable(digits = 4, row.names = F, caption = "Allometric growth parameters for eight published papers, Fishbase (Froese and Pauly 2016), and this study. All parameters have been adjusted to convert from millimiters to grams. n = Sample size, a = scaling parameter for eq. 1, c = y-intercept for eq. 3, b = exponent or slope for eq. 1 or eq. 2, respectively.")

review_table
```


```{r scatter plot, include = F}

a <- coefficients(model)[[1]]
b <- coefficients(model)[[2]]

predicted_this_study <- data.frame(Length = seq(min(fish$Length), max(fish$Length), by = 1)) %>% 
  mutate(Weight = 10^a*Length^b)

plot_fit_this_study <-  ggplot(data = fish, mapping = aes(x = Length, y = Weight)) +
  geom_line(data = predicted_this_study, mapping = aes(x = Length, y = Weight), size = 1) +
  geom_point(size = 2, alpha = 0.25, color = "black") +
  theme_bw() +
  labs(x = "Total length (mm)", y = "Total Weight (g)") +
  theme(text = element_text(family = "Times")) +
  scale_color_brewer(palette = "Set3") +
  theme(text=element_text(family="Times"))

plot_fit_this_study
```

```{r review plots, include = F}
predicted_all <- data.frame(Length = seq(min(fish$Length), max(fish$Length), by = 1)) %>% 
  mutate(This = review$a[14] * (Length^review$b[14]), 
         APA = review$a[1] * (Length^review$b[1]),
         APF = review$a[2] * (Length^review$b[2]),
         APM = review$a[3] * (Length^review$b[3]),
         Sandel = review$a[4] * (Length^review$b[4]),
         Chin = review$a[5] * (Length^review$b[4]),
         Barbour = review$a[6] * (Length^review$b[6]),
         deLeon = review$a[7] * (Length^review$b[7]),
         FoggA = review$a[8] * (Length^review$b[8]),
         FoggM = review$a[9] * (Length^review$b[9]),
         FoggF = review$a[10] * (Length^review$b[10]),
         Edwards = review$a[11] * (Length^review$b[11]),
         Sabido = review$a[12] * (Length^review$b[12]),
         FishBase = review$a[13] * (Length^review$b[13])) %>%
  gather(Study_id, Weight, -Length) %>% 
  left_join(review, by ="Study_id") %>% 
  mutate(ThisStudy = ifelse(Study_id == "This", "Actual", "Other"))

plot_fit_all_studies <- ggplot(data = fish, mapping = aes(x = Length, y = Weight)) +
  geom_line(data = predicted_all, mapping = aes(x = Length, y = Weight, linetype = Gender, color = Study), size = 1) +
  theme_bw() +
  labs(x = "Total length (mm)", y = "Total Weight (g)") +
  theme(text = element_text(family = "Times"),
        legend.justification=c(0,1),
        legend.position=c(0.01, 0.99),
        legend.background = element_rect(fill = "transparent", size=.5, linetype="dotted")) +
  guides(color = guide_legend(title=NULL)) +
  scale_color_brewer(palette = "Paired")

plot_fit_all_studies_log <- ggplot(data = fish, mapping = aes(x = Length, y = log10(Weight))) +
  geom_line(data = predicted_all, mapping = aes(x = Length, y = log10(Weight), linetype = Gender, color = Study), size = 1) +
  theme_bw() +
  labs(x = "Total length (mm)", y = "log10(TW)") +
  theme(text = element_text(family = "Times"),
        legend.position = "None")+
  scale_x_continuous(expand=c(0,0))+
  scale_y_continuous(expand=c(0,0))

gridExtra::grid.arrange(plot_fit_all_studies, plot_fit_all_studies_log)

```

```{r Predicted biomass for each site}
Predicted_biomass <- fish %>% 
  mutate(This = review$a[14] * (Length^review$b[14]), 
         APA = review$a[1] * (Length^review$b[1]),
         APF = review$a[2] * (Length^review$b[2]),
         APM = review$a[3] * (Length^review$b[3]),
         Sandel = review$a[4] * (Length^review$b[4]),
         Chin = review$a[5] * (Length^review$b[4]),
         Barbour = review$a[6] * (Length^review$b[6]),
         deLeon = review$a[7] * (Length^review$b[7]),
         FoggA = review$a[8] * (Length^review$b[8]),
         FoggM = review$a[9] * (Length^review$b[9]),
         FoggF = review$a[10] * (Length^review$b[10]),
         Edwards = review$a[11] * (Length^review$b[11]),
         Sabido = review$a[12] * (Length^review$b[12]),
         FishBase = review$a[13] * (Length^review$b[13])) %>% 
  group_by(Location) %>% 
  summarize(Observed = sum(Weight),
            This = sum(This)/Observed,
            APA = sum(APA)/Observed,
            APF = sum(APF)/Observed,
            APM = sum(APM)/Observed, 
            Sandel = sum(Sandel)/Observed,
            Chin = sum(Chin)/Observed,
            Barbour = sum(Barbour)/Observed,
            deLeon = sum(deLeon)/Observed,
            FoggA = sum(FoggA)/Observed,
            FoggM = sum(FoggM)/Observed,
            FoggF = sum(FoggF)/Observed,
            Edwards = sum(Edwards)/Observed,
            Sabido = sum(Sabido)/Observed,
            FishBase = sum(FishBase)/Observed) %>% 
  ungroup() %>% 
  gather(Study, Biomass, -Location)
```


```{r plot comparing predictions, include = F}
Predicted_biomass_plot <-   Predicted_biomass %>% 
  filter(!Study == "Observed") %>% 
  ggplot(aes(x = Study, y = Biomass)) +
  stat_summary(geom = "errorbar", fun.data = "mean_se", width = 0, size = 1) +
  stat_summary(geom = "point", fun.y = "mean", fill = "blue", size = 3, shape = 21) +
  geom_hline(yintercept = 1, linetype = "dashed") +
  labs(y = "Biomass (Predicted / Observed)") +
  coord_flip() +
  theme_bw() +
  theme(text = element_text(family = "Times"))

Predicted_biomass_plot
```


# Discussion and Conclusions

Not using spear poles allows us to have a full sample of fish with a wider range of sizes and weights, ideal for visual census. Also, there is no loss in body mass due to bleeding.

# Aknowledgements

\clearpage

# Tables

## Location table

```{r}
location_table
```

\clearpage

## Summary table

```{r, results = "asis"}
cat(summary_table)
```

\clearpage

## Regression table

```{r, results = "asis"}
cat(regression_table)
```

\clearpage

## Review table

```{r}
review_table
```


\clearpage

# Figures

## Map

```{r}
tmap_arrange(pen_map, study_area, outer.margins = 0.005, ncol = 2)
```

\clearpage

## Histograms

```{r, fig.width = 5, fig.height = 7}
gridExtra::grid.arrange(length_hist, weight_hist)
```

## Scatter plot

```{r}
plot_fit_this_study
```

## Review plots

```{r, fig.height = 9.5, fig.width = 6}
gridExtra::grid.arrange(plot_fit_all_studies, plot_fit_all_studies_log)
```


# References
